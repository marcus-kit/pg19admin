# План рефакторинга pg19v3admin

**Дата:** 2026-01-26
**Статус:** В работе

## Цели

1. Удалить весь мёртвый код, неиспользуемые функции и дублирование
2. Максимально упростить код, убрать повторяющиеся функции и аргументы
3. Привести код в соответствие с CODE-STYLE-GUIDE.md

## Стратегия

- **Подход:** Последовательный по этапам (чистка → упрощение → стиль)
- **Структура:** По слоям (composables → UI → pages → API)
- **Автономность:** Высокая, с отчётами после каждого слоя
- **Коммиты:** Один финальный коммит

## ЭТАП 1: Удаление мёртвого кода

### Что ищем

| Тип | Примеры |
|-----|---------|
| Неиспользуемые переменные | `const x = ...` без использования |
| Мёртвые функции | Функции без вызовов |
| Закомментированный код | `// old code` |
| Неиспользуемые импорты | `import { X }` где X не используется |
| Пустые обработчики | `catch {}`, `@click=""` |
| Неиспользуемые props/emits | Объявлены, но не используются |

### Порядок работы

1. composables/utils (7 файлов)
2. UI компоненты (18 файлов)
3. Pages (26 файлов)
4. Server API (62 файла)

### Не удаляем

- Публичные API эндпоинты
- Экспорты типов

## ЭТАП 2: Упрощение и дедупликация

### Что ищем и как упрощаем

| Проблема | Решение |
|----------|---------|
| Повторяющаяся логика в компонентах | Выносим в composable |
| Одинаковый код в API эндпоинтах | Выносим в server/utils |
| Сложные вложенные условия | Guard clauses (ранний return) |
| Длинные функции (>30 строк) | Разбиваем на меньшие |
| Цепочки `.then().then()` | async/await |
| Повторяющиеся try/catch | Единый error handler |
| Дублирующиеся типы | Централизация в types/ |

### Границы упрощения

- Не создаём абстракции ради одного использования (YAGNI)
- Сохраняем читаемость
- Не меняем публичные интерфейсы компонентов

## ЭТАП 3: CODE-STYLE-GUIDE alignment

### Что проверяем и исправляем

| Правило | Что делаем |
|---------|-----------|
| Порядок секций в .vue | `<script setup>` → `<template>` → `<style scoped>` |
| Порядок кода в script | imports → macros → props → emits → composables → state → computed → methods → watchers → lifecycle |
| Arrow → regular functions | Для методов компонентов |
| Именование компонентов | Префиксы Ui/App/The, минимум 2 слова |
| Vue attributes order | `:props` → `class` → static → `@events` |
| CSS Variables | Замена хардкод цветов на `var(--color-*)` |
| Комментарии | Только на русском |
| Форматирование | 2 пробела, одинарные кавычки, без `;`, trailing commas |

## Разбивка на задачи для суб-агентов

```
ЭТАП 1: Удаление мёртвого кода
├── Задача 1.1: composables + utils (7 файлов)
├── Задача 1.2: UI компоненты (18 файлов)
├── Задача 1.3: Pages (26 файлов) — 2 агента параллельно
└── Задача 1.4: Server API (62 файла) — 3 агента параллельно

ЭТАП 2: Упрощение (аналогичная структура)
ЭТАП 3: CODE-STYLE (аналогичная структура)
```

## Формат отчёта после каждого этапа

```
ЭТАП N ЗАВЕРШЁН
─────────────────
Изменения:
• [список изменений]

Файлы затронуты: X
Строк изменено: ~Y

Готов к ревью: git diff
```
